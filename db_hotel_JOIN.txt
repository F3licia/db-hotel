/*1. Come si chiamano gli ospiti che hanno fatto piÃ¹ di due prenotazioni?*/


SELECT `ospiti`.`name`, `ospiti`.`lastname`,
COUNT(`prenotazioni_has_ospiti`.`prenotazione_id`) AS `n_prenotazioni`
from `prenotazioni_has_ospiti`
LEFT JOIN `ospiti`
ON `prenotazioni_has_ospiti`.`ospite_id` = `ospiti`.`id`
GROUP BY `ospiti`.`id`
HAVING `n_prenotazioni` > 2


/*2. Stampare tutti gli ospiti per ogni prenotazione*/

SELECT `ospiti`.`name`, `ospiti`.`lastname`
FROM `prenotazioni_has_ospiti`
LEFT JOIN `ospiti`
ON `prenotazioni_has_ospiti`.`ospite_id` = `ospiti`.`id`


/*3. Stampare Nome, Cognome, Prezzo e Pagante per tutte le
prenotazioni fatte a Maggio 2018*/

SELECT `paganti`.`name`, `paganti`.`lastname` , `paganti`.`created_at`
FROM `paganti`
LEFT JOIN `pagamenti`
ON `paganti`.`id` = `pagamenti`.`pagante_id`
WHERE `paganti`.`created_at` LIKE "2018-05%"


/*4. Fai la somma di tutti i prezzi delle prenotazioni per le stanze del
primo piano*/

SELECT SUM(`price`)
FROM `pagamenti`
LEFT JOIN `prenotazioni`
ON `pagamenti`.`prenotazione_id` = `prenotazioni`.`id`
LEFT JOIN `stanze`
ON `prenotazioni`.`stanza_id` = `stanze`.`id`
WHERE `stanze`.`floor` = 1